<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="wechat_smallProgram," />





  <link rel="alternate" href="/atom.xml" title="Shirley" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="小程序开发文档的简要概括。">
<meta name="keywords" content="wechat_smallProgram">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序开发文档总结">
<meta property="og:url" content="http://yoursite.com/2018/03/26/微信小程序开发文档总结/index.html">
<meta property="og:site_name" content="Shirley">
<meta property="og:description" content="小程序开发文档的简要概括。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E9%85%8D%E7%BD%AE%E9%A1%B9window%E5%8F%82%E6%95%B0.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/APP%E6%B3%A8%E5%86%8C%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E9%A1%B5%E9%9D%A2%E6%B3%A8%E5%86%8C%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E.png">
<meta property="og:image" content="https://mp.weixin.qq.com/debug/wxadoc/dev/image/mina-lifecycle.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E8%B7%AF%E7%94%B1%E4%B8%8E%E9%A1%B5%E9%9D%A2%E6%A0%88.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E8%B7%AF%E7%94%B1%E7%9A%84%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/Tab%E5%88%87%E6%8D%A2%E5%AF%B9%E5%BA%94%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/WXML%E5%86%92%E6%B3%A1%E4%BA%8B%E4%BB%B6%E5%88%97%E8%A1%A8.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/WXSS%E7%9B%AE%E5%89%8D%E6%94%AF%E6%8C%81%E7%9A%84%E9%80%89%E6%8B%A9%E5%99%A8.png">
<meta property="og:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E5%86%8D%E6%AC%A1%E6%89%93%E5%BC%80%E9%80%BB%E8%BE%91.png">
<meta property="og:updated_time" content="2018-03-27T00:58:47.667Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="微信小程序开发文档总结">
<meta name="twitter:description" content="小程序开发文档的简要概括。">
<meta name="twitter:image" content="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/03/26/微信小程序开发文档总结/"/>





  <title>微信小程序开发文档总结 | Shirley</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-104091693-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?06185a244e6f872c8aeab11a4e7b5db4";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>
    <a href="https://github.com/shirley5li"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Shirley</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一只自学成菜的仙女!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/26/微信小程序开发文档总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ShirleyLi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirley">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">微信小程序开发文档总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-26T22:15:57+08:00">
                2018-03-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wechat-smallProgram/" itemprop="url" rel="index">
                    <span itemprop="name">wechat_smallProgram</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> Pageviews
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>小程序开发文档的简要概括。<br><a id="more"></a></p>
<h1 id="基本的文件结构"><a href="#基本的文件结构" class="headerlink" title="基本的文件结构"></a>基本的文件结构</h1><p>最关键也是必不可少的，是 app.js、app.json、app.wxss 这三个，<code>.js</code>后缀的是脚本文件，<code>.json</code>后缀的文件是配置文件，<code>.wxss</code>后缀的是样式表文件。</p>
<p><code>app.js</code>： 是小程序的脚本代码。我们可以在这个文件中监听并处理小程序的生命周期函数、声明全局变量，决定页面文件的路径、窗口表现、设置网络超时时间、设置多 tab 等。 调用框架提供的丰富的 API，如本例的同步存储及同步读取本地数据。</p>
<p><code>app.json</code>： 对整个小程序的全局配置。可以在这个文件中配置小程序是由哪些页面(<code>&quot;pages&quot;</code>)组成，配置小程序的窗口(<code>&quot;window&quot;</code>)背景色，配置导航条样式，配置默认标题。注意该文件不可添加任何注释。</p>
<p><code>app.wxss</code>： 整个小程序的公共样式表。我们可以在页面组件的 class 属性上直接使用 app.wxss 中声明的样式规则。</p>
<h1 id="创建页面"><a href="#创建页面" class="headerlink" title="创建页面"></a>创建页面</h1><p>小程序的页面都在根目录下的pages文件目录，例如一开始的示例程序中（有展示用户头像的欢迎页和小程序启动日志展示页），这两个页面都在pages目录下，即<code>pages/index/</code>和<code>pages/logs/</code>。</p>
<p>微信小程序中的每一个页面的【路径+页面名】都需要写在 app.json 的 <code>&quot;pages&quot;</code> 中，且 <code>&quot;pages&quot;</code> 中的第一个页面是小程序的首页。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="string">"pages"</span>:[</div><div class="line">  <span class="string">"pages/index/index"</span>,</div><div class="line">  <span class="string">"pages/logs/logs"</span></div><div class="line">],</div></pre></td></tr></table></figure>
<p>每一个小程序页面是由同路径下同名的四个不同后缀文件的组成，如：index.js(脚本)、 index.wxml(页面结构)、 index.wxss(样式表)、 index.json(配置)。</p>
<ul>
<li><p>index.wxml 是页面的结构文件。</p>
</li>
<li><p>index.js 是页面的脚本文件，在这个文件中我们可以监听并处理页面的生命周期函数、获取小程序实例，声明并处理数据，响应页面交互事件等。</p>
</li>
<li><p>index.wxss 是页面的样式表。 页面的样式表是非必要的。当有页面样式表时，页面的样式表中的样式规则会层叠覆盖 app.wxss 中的样式规则。如果不指定页面的样式表，也可以在页面的结构文件中直接使用 app.wxss 中指定的样式规则。</p>
</li>
</ul>
<p>注意微信小程序开发中使用了新的尺寸单位，<code>rpx</code>(responsive pixel)，可以根据屏幕宽度自适应，规定屏幕宽度为750rpx。</p>
<p>如在 iPhone6 上，屏幕宽度为375px，共有750个物理像素，则750rpx = 375px = 750物理像素，1rpx = 0.5px = 1物理像素。微信官方建议视觉稿以iPhone 6为标准。(补充rem: 规定屏幕宽度为20rem，所以1rem=750/20 rpx)</p>
<ul>
<li>index.json 是页面的配置文件。 页面的配置文件是非必要的。当有页面的配置文件时，配置项在该页面会覆盖 app.json 的 window 中相同的配置项。如果没有指定的页面配置文件，则在该页面直接使用 app.json 中的默认配置。</li>
</ul>
<p>文件目录安排如下所示如下图所示。<br><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt="小程序基本的目录结构"></p>
<h1 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h1><p>框架提供了自己的视图层描述语言WXML和WXSS，以及基于JavaScript的逻辑层框架，并在视图层与逻辑层间提供了数据传输和事件系统，可以让开发者可以方便的聚焦于数据与逻辑上。</p>
<ul>
<li>响应的数据绑定</li>
</ul>
<p>框架的核心是一个响应的数据绑定系统。整个系统分为两块视图层(View)和逻辑层(App Service)。框架可以让数据与视图非常简单地保持同步。当做数据修改的时候，只需要在逻辑层修改数据，视图层就会做相应的更新。</p>
<ul>
<li>页面管理</li>
</ul>
<p>框架管理了整个小程序的页面路由，可以做到页面间的无缝切换，并给以页面完整的生命周期。开发者需要做的只是将页面的数据，方法，生命周期函数注册进框架中，其他的一切复杂的操作都交由框架处理。</p>
<ul>
<li>基础组件</li>
</ul>
<p>框架提供了一套基础的组件，这些组件自带微信风格的样式以及特殊的逻辑，开发者可以通过组合基础组件，创建出强大的微信小程序 。</p>
<ul>
<li>丰富的API</li>
</ul>
<p>框架提供丰富的微信原生API，可以方便的调起微信提供的能力，如获取用户信息，本地存储，支付功能等。</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>使用app.json文件来对微信小程序进行全局配置，决定页面文件的路径、窗口表现、设置网络超时时间、设置多 tab 等。<a href="https://www.w3cschool.cn/weixinapp/hw9k1q8m.html" target="_blank" rel="noopener">app.json的配置项</a>列表包括： <code>pages</code> <code>window</code> <code>tabBar</code> <code>networkTimeout</code> <code>debug</code>。</p>
<p><code>pages</code> ：接受一个数组，每一项都是字符串，来指定小程序由哪些页面组成。每一项代表对应页面的【路径+文件名】信息，数组的第一项代表小程序的初始页面。小程序中新增/减少页面，都需要对 pages 数组进行修改。 文件名不需要写文件后缀，因为框架会自动去寻找路径.json,.js,.wxml,.wxss的四个文件进行整合。</p>
<p><code>window</code>： 用于设置小程序的状态栏、导航条、标题、窗口背景色。具体参数如下：<br><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E9%85%8D%E7%BD%AE%E9%A1%B9window%E5%8F%82%E6%95%B0.png" alt="window配置项参数"></p>
<p><code>tabBar</code>： 如果我们的小程序是一个多 tab 应用（客户端窗口的底部有tab栏可以切换页面），那么我们可以通过 tabBar 配置项指定 tab 栏的表现，以及 tab 切换时显示的对应页面。</p>
<p>page.json： 每一个小程序页面也可以使用.json文件来对本页面的窗口表现进行配置。页面的配置比app.json全局配置简单得多，只是设置 app.json 中的 window 配置项的内容，页面中配置项会覆盖 app.json 的 window 中相同的配置项。页面的.json只能设置window相关的配置项，以决定本页面的窗口表现，所以无需写window这个键。</p>
<h1 id="逻辑层-APP-Service"><a href="#逻辑层-APP-Service" class="headerlink" title="逻辑层(APP Service)"></a>逻辑层(APP Service)</h1><p>小程序开发框架的逻辑层是由JavaScript编写。 逻辑层将数据进行处理后发送给视图层，同时接受视图层的事件反馈。 在javascript基础上，增加 App 和 Page 方法，进行程序和页面的注册； 提供丰富的 API，如扫一扫，支付等微信特有能力； 每个页面有独立的作用域，并提供模块化能力； 由于框架并非运行在浏览器中，所以 JavaScript 在 web 中一些能力都无法使用，如 document，window 等； 开发者写的所有代码最终将会打包成一份 JavaScript，并在小程序启动的时候运行，直到小程序销毁。类似 ServiceWorker，所以逻辑层也称之为 App Service。</p>
<h2 id="注册程序"><a href="#注册程序" class="headerlink" title="注册程序"></a>注册程序</h2><p><strong>APP()</strong></p>
<p>App()函数用来注册一个小程序。接受一个object参数，其指定小程序的生命周期函数等。<br><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/APP%E6%B3%A8%E5%86%8C%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E.png" alt="APP注册参数说明"></p>
<p>前台、后台定义：当用户点击左上角关闭，或者按了设备 Home 键离开微信，小程序并没有直接销毁，而是进入了后台；当再次进入微信或再次打开小程序，又会从后台进入前台。需要注意的是：只有当小程序进入后台一定时间，或者系统资源占用过高，才会被真正的销毁。</p>
<p>关闭小程序(基础库版本1.1.0开始支持)：当用户从扫一扫、转发等入口(场景值为1007, 1008, 1011, 1025)进入小程序，且没有置顶小程序的情况下退出，小程序会被销毁。小程序运行机制在基础库版本 1.4.0 有所改变：上一条关闭逻辑在新版本已不适用，。</p>
<p><strong>getAPP()</strong></p>
<p>提供了全局的getApp()函数，可以获取到小程序实例。</p>
<p><strong>注意：</strong>App()必须在app.js中注册，且不能注册多个。</p>
<p>不要在定义于App()内的函数中调用getApp()，使用this就可以拿到app实例。</p>
<p>不要在onLaunch的时候调用getCurrentPage()，此时page还没有生成。</p>
<p>通过getApp()获取实例之后，不要私自调用生命周期函数。</p>
<h2 id="场景值"><a href="#场景值" class="headerlink" title="场景值"></a>场景值</h2><p><a href="https://www.w3cschool.cn/weixinapp/weixinapp-scene.html" target="_blank" rel="noopener">场景值</a>描述了开启小程序的来源，例如如果从发现栏小程序主入口开启，场景值为1001。可以在 App 的 onLaunch 和 onShow 中获取。</p>
<h2 id="注册页面"><a href="#注册页面" class="headerlink" title="注册页面"></a>注册页面</h2><p><strong>Page()</strong></p>
<p>Page() 函数用来注册一个页面。接受一个 object 参数，其指定页面的初始数据、生命周期函数、事件处理函数等。</p>
<p><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E9%A1%B5%E9%9D%A2%E6%B3%A8%E5%86%8C%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E.png" alt="页面注册参数说明"></p>
<p><strong>初始化数据</strong> 将作为页面的第一次渲染。data 将会以 JSON 的形式由逻辑层传至渲染层，所以其数据必须是可以转成 JSON 的格式：字符串，数字，布尔值，对象，数组。渲染层可以通过 WXML 对数据进行绑定。</p>
<pre><code>Page.prototype.route  route字段可以获取到当前页面的路径。
Page.prototype.setData()  setData 函数用于将数据从逻辑层发送到视图层，同时改变对应的 this.data 的值。
</code></pre><p>setData() 参数格式： 接受一个对象，以 key，value 的形式表示将 this.data 中的 key 对应的值改变成 value。ey 可以非常灵活，以数据路径的形式给出，如 array[2].message，a.b.c.d，并且不需要在 this.data 中预先定义。</p>
<p>注意：</p>
<pre><code>直接修改 this.data 而不调用 this.setData 是无法改变页面的状态的，还会造成数据不一致
单次设置的数据不能超过1024kB，请尽量避免一次设置过多的数据。
</code></pre><p><strong>Page实例的生命周期</strong></p>
<p><img src="https://mp.weixin.qq.com/debug/wxadoc/dev/image/mina-lifecycle.png" alt="Page实例的生命周期"></p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p><strong>页面路由：</strong>所有页面的路由全部由框架进行管理。</p>
<p><strong>页面栈：</strong> 框架以栈的形式维护了当前的所有页面。当发生路由切换的时候，页面栈的表现如下：<br><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E8%B7%AF%E7%94%B1%E4%B8%8E%E9%A1%B5%E9%9D%A2%E6%A0%88.png" alt="路由与页面栈"></p>
<p><strong>getCurrentPages()</strong> 用于获取当前页面栈的实例，以数组形式按栈的顺序给出，第一个元素为首页，最后一个元素为当前页面。(注意;不要尝试修改页面栈，会导致路由以及页面状态错误。)</p>
<p><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E8%B7%AF%E7%94%B1%E7%9A%84%E8%A7%A6%E5%8F%91%E6%96%B9%E5%BC%8F.png" alt="路由的触发方式"></p>
<p><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/Tab%E5%88%87%E6%8D%A2%E5%AF%B9%E5%BA%94%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="Tab切换对应的生命周期"></p>
<pre><code>navigateTo,redirectTo只能打开非 tabBar 页面。
switchTab 只能打开 tabBar 页面。
reLaunch 可以打开任意页面。
页面底部的 tabBar 由页面决定，即只要是定义为 tabBar 的页面，底部都有 tabBar。
调用页面路由带的参数可以在目标页面的onLoad中获取。
</code></pre><h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><p>文件作用域：在JavaScript文件中声明的变量和函数只在该文件中有效；不同的文件中可以声明相同名字的变量和函数，不会互相影响。</p>
<p>通过全局函数getApp()可以获取全局的应用实例，如果需要全局的数据可以在App()中设置全局数据。</p>
<p><strong>模块化：</strong> 将一些公共的代码抽离成为一个单独的js文件，作为一个模块。模块只有通过module.exports或者 exports才能对外暴露接口。​在需要使用这些模块的文件中，使用require(path)将公共代码引入(tips: require暂时不支持绝对路径)。</p>
<p>注意： exports是module.exports的一个引用，因此在模块里边随意更改exports的指向会造成未知的错误。所以我们更推荐开发者采用module.exports来暴露模块接口，除非你已经清晰知道这两者的关系。</p>
<h1 id="视图层-View"><a href="#视图层-View" class="headerlink" title="视图层(View)"></a>视图层(View)</h1><h2 id="WXML"><a href="#WXML" class="headerlink" title="WXML"></a>WXML</h2><p>WXML(WeiXin Markup Language)是框架设计的一套标签语言，结合基础组件、事件系统，可以构建出页面的结构。</p>
<p>WXML具有数据绑定、列表渲染、条件渲染、模板、事件、引用等功能。</p>
<h3 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h3><p>WXML中的动态数据均来自对应Page的 <code>data</code>对象中的数据。数据绑定使用 双大括号 将变量包起来。</p>
<p>（1）用于内容： <code>&lt;view&gt; {{ message }} &lt;/view&gt;</code></p>
<p>（2）组件属性(需要在双引号之内)： <code>&lt;view id=&quot;item-{{id}}&quot;&gt; &lt;/view&gt;</code></p>
<p>（3）控制属性(需要在双引号之间)： <code>&lt;view wx:if=&quot;{{condition}}&quot;&gt; &lt;/view&gt;</code></p>
<p>（4）关键字(需要在双引号之间)： <code>&lt;checkbox checked=&quot;{{false}}&quot;&gt; &lt;/checkbox&gt;</code> 其中 false：boolean 类型的 false，代表假值。<br>注意: 特别注意：不要直接写 <code>checked=&quot;false&quot;</code>，其计算结果是一个字符串，转成 boolean 类型后代表真值。</p>
<p>（5）计算： 可以在{{}}内进行简单的运算。支持以下几种方式，</p>
<p>三元运算： <code>&lt;view hidden="{{flag ? true : false}}&quot;&gt; Hidden &lt;/view&gt;</code></p>
<p>算数运算： <code>view&gt; {{a + b}} + {{c}} + d &lt;/view&gt;</code></p>
<p>逻辑判断： <code>&lt;view wx:if=&quot;{{length > 5}}&quot;&gt; &lt;/view&gt;</code></p>
<p>字符串运算： <code>&lt;view&gt;{{"hello" + name}}&lt;/view&gt;</code></p>
<p>数据路径运算： <code>&lt;view&gt;{{object.key}} {{array[0]}}&lt;/view&gt;</code></p>
<p>组合： 也可以在Mustache(双大括号)内直接进行组合，构成新的对象或者数组。</p>
<p>数组：<code>&lt;view wx:for-items=&quot;{{[zero, 1, 2, 3, 4]}}&quot;&gt; {{item}} &lt;/view&gt;</code></p>
<pre><code>Page({
  data: {
    zero: 0
  }
})
</code></pre><p>对象： <code>&lt;template is=&quot;objectCombine&quot; data=&quot;{{for: a, bar: b}}&quot;&gt;&lt;/template&gt;</code>， 最终组合成的对象是<code>{for: 1, bar: 2}</code></p>
<pre><code>Page({
  data: {
    a: 1,
    b: 2
  }
})
</code></pre><p>也可以用扩展运算符…来将一个对象展开，<code>&lt;template is=&quot;objectCombine&quot; data=&quot;{{...obj1, ...obj2, e: 5}}&quot;&gt;&lt;/template&gt;</code>,最终组合成的对象是<code>{a: 1, b: 2, c: 3, d: 4, e: 5}</code></p>
<pre><code>Page({
  data: {
    obj1: {
      a: 1,
      b: 2
    },
    obj2: {
      c: 3,
      d: 4
    }
  }
})
</code></pre><p>注意：注意：上述方式可以随意组合，但是如有存在变量名相同的情况，后边的会覆盖前面，如<code>&lt;template is=&quot;objectCombine&quot; data=&quot;{{...obj1, ...obj2, a, c: 6}}&quot;&gt;&lt;/template&gt;</code>，根据以下数据，最终组合成的对象是 <code>{a: 5, b: 3, c: 6}</code>。</p>
<pre><code>Page({
  data: {
    obj1: {
      a: 1,
      b: 2
    },
    obj2: {
      b: 3,
      c: 4
    },
    a: 5
  }
})
</code></pre><p>注意： 花括号和引号之间如果有空格，将最终被解析成为字符串,如下</p>
<pre><code>&lt;view wx:for=&quot;{{[1,2,3]}} &quot;&gt;
  {{item}}
&lt;/view&gt;
</code></pre><p>等同于</p>
<pre><code>&lt;view wx:for=&quot;{{[1,2,3] + ' '}}&quot;&gt;
  {{item}}
&lt;/view&gt;
</code></pre><h3 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h3><p>（1）<strong>wx:for</strong></p>
<p><strong>wx:for</strong> 在组件上使用 wx:for 控制属性绑定一个数组，即可使用数组中各项的数据重复渲染该组件。默认数组的当前项的下标变量名默认为 <code>index</code>，数组当前项的变量名默认为 <code>item</code>。</p>
<pre><code>&lt;view wx:for=&quot;{{array}}&quot;&gt;
  {{index}}: {{item.message}}
&lt;/view&gt;
</code></pre><p><strong>wx:for-item</strong> 指定数组当前元素的变量名。</p>
<p><strong>wx:for-index</strong> 指定数组当前下标的变量名。</p>
<pre><code>&lt;view wx:for=&quot;{{array}}&quot; wx:for-index=&quot;idx&quot; wx:for-item=&quot;itemName&quot;&gt;
  {{idx}} {{itemName.message}}
&lt;/view&gt;
</code></pre><p>wx:for 也可以嵌套，下边是一个九九乘法表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;view wx:for=&quot;&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&quot; wx:for-item=&quot;i&quot;&gt;</div><div class="line">  &lt;view wx:for=&quot;&#123;&#123;[1, 2, 3, 4, 5, 6, 7, 8, 9]&#125;&#125;&quot; wx:for-item=&quot;j&quot;&gt;</div><div class="line">    &lt;view wx:if=&quot;&#123;&#123;i &lt;= j&#125;&#125;&quot;&gt;</div><div class="line">     &#123;&#123;i&#125;&#125; *&#123;&#123;j&#125;&#125; = &#123;&#123;i * j&#125;&#125;</div><div class="line">    &lt;/view&gt;</div><div class="line">  &lt;/view&gt;</div><div class="line">&lt;/view&gt;</div></pre></td></tr></table></figure>
<p>（2）<strong>block wx:for</strong></p>
<p>将 wx:for 用在<code>&lt;block/&gt;</code>标签上，以渲染一个包含多节点的结构块。</p>
<pre><code>&lt;block wx:for=&quot;{{[1, 2, 3]}}&quot;&gt;
  &lt;view&gt; {{index}}: &lt;/view&gt;
  &lt;view&gt; {{item}} &lt;/view&gt;
&lt;/block&gt;
</code></pre><p>（3）<strong>wx:key</strong></p>
<p>如果列表中项目的位置会动态改变或者有新的项目添加到列表中，并且希望列表中的项目保持自己的特征和状态（如 <code>&lt;input/&gt;</code> 中的输入内容，<code>&lt;switch/&gt;</code> 的选中状态），需要使用 wx:key 来<code>指定列表中项目的唯一的标识符</code>。</p>
<p>wx:key 的值以两种形式提供:</p>
<pre><code>1.字符串，代表在 for 循环的 array 中 item 的某个 property，该 property 的值需要是列表中唯一的字符串或数字，且不能动态改变。
2.保留关键字 *this 代表在 for 循环中的 item 本身，这种表示需要 item 本身是一个唯一的字符串或者数字，如：
</code></pre><p>当数据改变触发渲染层重新渲染的时候，会校正带有 key 的组件，框架会确保他们被重新排序，而不是重新创建，以确保使组件保持自身的状态，并且提高列表渲染时的效率。</p>
<p>注意： 当 wx:for 的值为字符串时，会将字符串解析成字符串数组。</p>
<pre><code>&lt;view wx:for=&quot;array&quot;&gt;
  {{item}}
&lt;/view&gt;
</code></pre><p>等同于</p>
<pre><code>&lt;view wx:for=&quot;{{['a','r','r','a','y']}}&quot;&gt;
  {{item}}
&lt;/view&gt;
</code></pre><h3 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h3><p>（1）<strong>wx:if</strong></p>
<p>用<code>wx:if=&quot;{{condition}}&quot;</code>来判断是否需要渲染该代码块, <code>&lt;view wx:if=&quot;{{condition}}&quot;&gt; True &lt;/view&gt;</code>。也可以用<code>wx:elif</code>和<code>wx:else</code>来添加一个else块：</p>
<pre><code>&lt;view wx:if=&quot;{{length > 5}}&quot;&gt; 1 &lt;/view&gt;
&lt;view wx:elif=&quot;{{length > 2}}&quot;&gt; 2 &lt;/view&gt;
&lt;view wx:else&gt; 3 &lt;/view&gt;
</code></pre><p>（2）<strong>block wx:if</strong></p>
<p><code>wx:if</code>是一个控制属性，需要将它添加到一个标签上。如果想一次性判断多个组件标签，可以使用一个<code>&lt;block/&gt;</code>标签将多个组件包装起来，并在上边使用<code>wx:if</code>控制属性。</p>
<pre><code>&lt;block wx:if=&quot;{{true}}&quot;&gt;
  &lt;view&gt; view1 &lt;/view&gt;
  &lt;view&gt; view2 &lt;/view&gt;
&lt;/block&gt;
</code></pre><p>注意：<code>&lt;block/&gt;</code>并不是一个组件，它仅仅是一个包装元素，不会在页面中做任何渲染，只接受控制属性。</p>
<p><code>wx:if</code> <strong>vs</strong> <code>hidden</code></p>
<p>因为<code>wx:if</code>之中的模板也可能包含数据绑定，所以当<code>wx:if</code>的条件值切换时，框架有一个局部渲染的过程，因为它会确保条件块在切换时销毁或重新渲染。同时<code>wx:if</code>也是惰性的，如果在初始渲染条件为<code>false</code>，框架什么也不做，在条件第一次变成真的时候才开始局部渲染。</p>
<p>相比之下，<code>hidden</code>就简单的多，组件始终会被渲染，只是简单的控制显示与隐藏。</p>
<p>一般来说，<code>wx:if</code>有更高的切换消耗而<code>hidden</code>有更高的初始渲染消耗。因此，如果需要频繁切换的情景下，用<code>hidden</code>更好，如果在运行时条件不大可能改变则<code>wx:if</code>较好。</p>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>WXML提供模板（template），可以在模板中定义代码片段，然后在不同的地方调用。 模板拥有自己的作用域，只能使用data传入的数据。</p>
<p>（1）定义模板：使用name属性，作为模板的名字，然后在<code>&lt;template/&gt;</code>内定义代码片段。如下：</p>
<pre><code>&lt;template name=&quot;msgItem&quot;&gt;
  &lt;view&gt;
    &lt;text&gt; {{index}}: {{msg}} &lt;/text&gt;
    &lt;text&gt; Time: {{time}} &lt;/text&gt;
  &lt;/view&gt;
&lt;/template&gt;
</code></pre><p>（2）使用模板： 使用 <code>is</code>属性，声明需要使用的模板，然后将模板所需要的data传入。 <code>&lt;template is=&quot;msgItem&quot; data=&quot;{{...item}}&quot;/&gt;</code></p>
<pre><code>Page({
  data: {
    item: {
      index: 0,
      msg: &apos;this is a template&apos;,
      time: &apos;2016-09-15&apos;
    }
  }
})
</code></pre><p><code>is</code> 属性可以使用Mustache语法，来动态决定具体需要渲染哪个模板。</p>
<pre><code>&lt;template name=&quot;odd&quot;&gt;
  &lt;view&gt; odd &lt;/view&gt;
&lt;/template&gt;
&lt;template name=&quot;even&quot;&gt;
  &lt;view&gt; even &lt;/view&gt;
&lt;/template&gt;

&lt;block wx:for=&quot;{{[1, 2, 3, 4, 5]}}&quot;&gt;
    &lt;template is=&quot;{item % 2 == 0 ? &apos;even&apos; : &apos;odd&apos;}}&quot;/&gt;
&lt;/block&gt;
</code></pre><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>什么是事件：<br>    事件是视图层到逻辑层的通讯方式。<br>    事件可以将用户的行为反馈到逻辑层进行处理。<br>    事件可以绑定在组件上，当达到触发事件，就会执行逻辑层中对应的事件处理函数。<br>    事件对象可以携带额外信息，如id, dataset, touches。 </p>
<p>（1）事件的使用方式 </p>
<ul>
<li><p>在组件中绑定一个事件处理函数，如 <code>bindtap</code>，当用户点击该组件的时候会在该页面对应的Page中找到相应的事件处理函数。<br><code>&lt;view id=&quot;tapTest&quot; data-hi=&quot;WeChat&quot; bindtap=&quot;tapName&quot;&gt; Click me! &lt;/view&gt;</code></p>
</li>
<li><p>在相应的Page定义中写上相应的事件处理函数，参数是event。</p>
<p>  Page({</p>
<pre><code>tapName: function(event) {
  console.log(event)
}
</code></pre><p>  })</p>
</li>
</ul>
<p>事件分为<strong>冒泡事件</strong>(当一个组件上的事件被触发后，该事件会向父节点传递)和<strong>非冒泡事件</strong>(当一个组件上的事件被触发后，该事件不会向父节点传递),WXML的冒泡事件列表如下：<br><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/WXML%E5%86%92%E6%B3%A1%E4%BA%8B%E4%BB%B6%E5%88%97%E8%A1%A8.png" alt="WXML冒泡事件列表"></p>
<p>tips：除上表之外的其他组件自定义事件都是非冒泡事件，如<code>&lt;form/&gt;</code>的submit事件，<code>&lt;input/&gt;</code>的input事件，<code>&lt;scroll-view/&gt;</code>的scroll事件。</p>
<p>（2）事件的绑定</p>
<p>事件绑定的写法同组件的属性，以key、value的形式。 key以<code>bind</code>或<code>catch</code>开头，然后跟上事件的类型，如<code>bindtap</code>, <code>catchtouchstart</code>。 value是一个字符串，需要在对应的Page中定义同名的函数。不然当触发事件的时候会报错。 </p>
<p><code>bind</code>事件绑定不会阻止冒泡事件向上冒泡，<code>catch</code>事件绑定可以阻止冒泡事件向上冒泡。例如，如在下边这个例子中，点击inner view会先后触发<code>handleTap3</code>和<code>handleTap2</code>(因为tap事件会冒泡到middle view，而middle view阻止了tap事件冒泡，不再向父节点传递)，点击middle view会触发<code>handleTap2</code>，点击outter view会触发<code>handleTap1</code>。</p>
<pre><code>&lt;view id=&quot;outter&quot; bindtap=&quot;handleTap1&quot;&gt;
  outer view
  &lt;view id=&quot;middle&quot; catchtap=&quot;handleTap2&quot;&gt;
    middle view
    &lt;view id=&quot;inner&quot; bindtap=&quot;handleTap3&quot;&gt;
      inner view
    &lt;/view&gt;
  &lt;/view&gt;
&lt;/view&gt;
</code></pre><p>（3）事件对象</p>
<p>当组件触发事件时，逻辑层绑定该事件的处理函数会收到一个事件对象。事件对象属性如下：<br><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E4%BA%8B%E4%BB%B6%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8.png" alt="事件对象属性"></p>
<p>在组件中可以定义数据，这些数据将会通过事件传递给 SERVICE。书写方式：以<code>data-</code>开头，多个单词由连字符<code>-</code>链接，不能有大写(大写会自动转成小写)如<code>data-element-type</code>，最终在 <code>event.target.dataset</code> 中会将连字符转成驼峰elementType。</p>
<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p>WXML提供两种文件引用方式<code>import</code>和<code>include</code>。</p>
<p>（1）import</p>
<p>import可以在该文件中使用目标文件定义的template。 import有作用域的概念，即只会import目标文件中定义的template，而不会import目标文件import的template。</p>
<p>（2）include</p>
<p>include可以将目标文件除了<code>&lt;template/&gt;</code>的整个代码引入，相当于是拷贝到include位置。（感觉有点ejs中模板include的感觉）</p>
<h2 id="WXS"><a href="#WXS" class="headerlink" title="WXS"></a>WXS</h2><p>WXS（WeiXin Script）是小程序的一套脚本语言，结合 WXML，可以构建出页面的结构。</p>
<p>注意:</p>
<pre><code>wxs 不依赖于运行时的基础库版本，可以在所有版本的小程序中运行。
wxs 与 javascript 是不同的语言，有自己的语法，并不和 javascript 一致。
wxs 的运行环境和其他 javascript 代码是隔离的，wxs 中不能调用其他 javascript 文件中定义的函数，也不能调用小程序提供的API。
wxs 函数不能作为组件的事件回调。
由于运行环境的差异，在 iOS 设备上小程序内的 wxs 会比 javascript 代码快 2 ~ 20 倍。在 android 设备上二者运行效率无差异。
</code></pre><p>wxs用于页面渲染的使用示例，页面输出 hello world：</p>
<pre><code>&lt;!--wxml--&gt;
&lt;wxs module=&quot;m1&quot;&gt;
var msg = &quot;hello world&quot;;

module.exports.message = msg;
&lt;/wxs&gt;

&lt;view&gt; {{m1.message}} &lt;/view&gt;
</code></pre><p>wxs还可用于数据处理。</p>
<h3 id="WXS模块"><a href="#WXS模块" class="headerlink" title="WXS模块"></a>WXS模块</h3><p>WXS 代码可以编写在 wxml 文件中的 <code>&lt;wxs&gt;</code> 标签内，或以 .wxs 为后缀名的文件内。</p>
<pre><code>每一个 .wxs 文件和 &lt;wxs&gt; 标签都是一个单独的模块。
每个模块都有自己独立的作用域。即在一个模块里面定义的变量与函数，默认为私有的，对其他模块不可见。
一个模块要想对外暴露其内部的私有变量与函数，只能通过 module.exports 实现。
</code></pre><p>每个 wxs 模块均有一个内置的 module 对象,通过exports属性，可以对外共享本模块的私有变量与函数。</p>
<p>在.wxs模块中引用其他 wxs 文件模块，可以使用 require 函数。引用的时候，要注意如下几点：</p>
<pre><code>只能引用 .wxs 文件模块，且必须使用相对路径。
wxs 模块均为单例，wxs 模块在第一次被引用时，会自动初始化为单例对象。多个页面，多个地方，多次引用，使用的都是同一个 wxs 模块对象。
如果一个 wxs 模块在定义之后，一直没有被引用，则该模块不会被解析与运行。
</code></pre><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><pre><code>WXS 中的变量均为值的引用。
没有声明的变量直接赋值使用，会被定义为全局变量。
如果只声明变量而不赋值，则默认值为 undefined。
var表现与javascript一致，会有变量提升。
</code></pre><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>单行注释 <code>//</code> 多行注释<code>/* */</code></p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>WXS 语言目前共有以下几种数据类型：</p>
<pre><code>number ： 数值
string ：字符串
boolean：布尔值
object：对象
function：函数
array : 数组
date：日期
regexp：正则
</code></pre><p>(1)number 整数、小数</p>
<p>方法：</p>
<pre><code>toString
toLocaleString
valueOf
toFixed
toExponential
toPrecision
</code></pre><p>(2)string </p>
<p>方法:</p>
<pre><code>toString
valueOf
charAt
charCodeAt
concat
indexOf
lastIndexOf
localeCompare
match
replace
search
slice
split
substring
toLowerCase
toLocaleLowerCase
toUpperCase
toLocaleUpperCase
trim
</code></pre><p>(3)boolean</p>
<p>方法:</p>
<pre><code>toString
valueOf
</code></pre><p>(4)object</p>
<p>方法:</p>
<pre><code>toString：返回字符串 &quot;[object Object]&quot;
</code></pre><p>(5)function</p>
<p>方法:</p>
<pre><code>toString：返回字符串 &quot;[function Function]&quot;。
</code></pre><p>(6)array</p>
<p>方法:</p>
<pre><code>toString
concat
join
pop
push
reverse
shift
slice
sort
splice
unshift
indexOf
lastIndexOf
every
some
forEach
map
filter
reduce
reduceRight
</code></pre><p>(7)date </p>
<p>生成 date 对象需要使用 getDate()函数, 返回一个当前时间的对象。date类型还有很多<a href="https://www.w3cschool.cn/weixinapp/weixinapp-54te2czr.html" target="_blank" rel="noopener">方法</a>。</p>
<p>(8)regexp </p>
<p>生成 regexp 对象需要使用 getRegExp()函数。 方法有<code>exec</code>、<code>test</code>、<code>toString</code>。</p>
<p>tips: 数据类型的判断可以使用 constructor 属性。使用 typeof 也可以区分部分数据类型。</p>
<h2 id="WXSS"><a href="#WXSS" class="headerlink" title="WXSS"></a>WXSS</h2><p>WXSS(WeiXin Style Sheets)是一套样式语言，用于描述WXML的组件样式。WXSS具有CSS大部分特性。同时为了更适合开发微信小程序，对CSS进行了扩充以及修改。扩展的特性有尺寸单位、样式导入。</p>
<p>尺寸单位：px（responsive pixel），可以根据屏幕宽度进行自适应。规定屏幕宽为750rpx。如在iPhone6上，屏幕宽度为375px，共有750个物理像素，则750rpx = 375px = 750物理像素，1rpx = 0.5px = 1物理像。</p>
<p>样式导入：使用@import语句可以导入外联样式表，@import跟需要导入的外联样式表的相对路径（相对路径放在引号中），用<code>;</code>表示语句结束。</p>
<p>内联样式：框架组件上支持使用style、class属性来控制组件的样式。</p>
<ul>
<li>style：静态的样式统一写到class中。style接收动态的样式，在运行时会进行解析，尽量避免将静态的样式写进style中，以免影响渲染速度。<br><code>&lt;view style=&quot;color:{{color}};&quot; /&gt;</code></li>
</ul>
<p><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/WXSS%E7%9B%AE%E5%89%8D%E6%94%AF%E6%8C%81%E7%9A%84%E9%80%89%E6%8B%A9%E5%99%A8.png" alt="WXSS目前支持的选择器"></p>
<h1 id="兼容"><a href="#兼容" class="headerlink" title="兼容"></a>兼容</h1><p>小程序的功能不断的增加，但是旧版本的微信客户端并不支持新功能，所以在使用这些新能力的时候需要做兼容。文档会在组件，API等页面描述中带上各个功能所支持的版本号。</p>
<p>可以通过<code>wx.getSystemInfo</code>或者<code>wx.getSystemInfoSync</code>获取到小程序的基础库版本号。也可以通过 <code>wx.canIUse</code> 来判断是否可以在该基础库版本下直接使用对应的API或者组件。</p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>对于新增的 API，可以用以下代码来判断是否支持用户的手机。</p>
<pre><code>if (wx.openBluetoothAdapter) {
  wx.openBluetoothAdapter()
} else {
  // 如果希望用户在最新版本的客户端上体验您的小程序，可以这样子提示
  wx.showModal({
    title: &apos;提示&apos;,
    content: &apos;当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。&apos;
  })
}
</code></pre><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>对于 API 的参数或者返回值有新增的参数，可以用以下代码判断。</p>
<pre><code>wx.showModal({
  success: function(res) {
    if (wx.canIUse(&apos;showModal.cancel&apos;)) {
      console.log(res.cancel)
    }
  }
})
</code></pre><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><p>对于组件，新增的属性在旧版本上不会被处理，不过也不会报错。如果特殊场景需要对旧版本做一些降级处理，可以这样子做。</p>
<pre><code>Page({
  data: {
    canIUse: wx.canIUse(&apos;button.open-type.contact&apos;)
  }
})
&lt;!-- wxml --&gt;
&lt;button wx:if=&quot;{{canIUse}}&quot; open-type=&quot;contact&quot;&gt; 客服消息 &lt;/button&gt;
&lt;contact-button wx:else&gt;&lt;/contact-button&gt;
</code></pre><h1 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h1><pre><code>小程序没有重启的概念
当小程序进入后台，客户端会维持一段时间的运行状态，超过一定时间后（目前是5分钟）会被微信主动销毁
置顶的小程序不会被微信主动销毁
当收到系统内存告警也会进行小程序的销毁
</code></pre><p>再次打开逻辑： 基础库 1.4.0 开始支持，低版本需做兼容处理。</p>
<pre><code>用户打开小程序的预期有以下两类场景：
A. 打开首页： 场景值有 1001, 1019, 1022, 1023, 1038, 1056
B. 打开小程序指定的某个页面： 场景值为除 A 以外的其他
</code></pre><p><img src="http://ou3oh86t1.bkt.clouddn.com/smallProgram/images/%E5%86%8D%E6%AC%A1%E6%89%93%E5%BC%80%E9%80%BB%E8%BE%91.png" alt="再次打开逻辑"></p>
<h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><p>setData是小程序开发中使用最频繁的接口，也是最容易引发性能问题的接口。</p>
<p><code>setData</code>工作原理：</p>
<p>小程序的视图层目前使用 WebView 作为渲染载体，而逻辑层是由独立的 JavascriptCore 作为运行环境。在架构上，WebView 和 JavascriptCore 都是独立的模块，并不具备数据直接共享的通道。当前，视图层和逻辑层的数据传输，实际上通过两边提供的evaluateJavascript所实现。即用户传输的数据(由视图层去往逻辑层)，需要将其转换为字符串形式传递，同时把转换后的数据内容拼接成一份 JS 脚本，再通过执行 JS 脚本的形式传递到两边独立环境。</p>
<p>而evaluateJavascript的执行会受很多方面的影响，数据到达视图层并不是实时的。同一进程内的 WebView 实际上会共享一个 JS VM，如果 WebView 内 JS 线程正在执行渲染或其他逻辑，会影响 evaluateJavascript 脚本的实际执行时间，另外多个 WebView 也会抢占 JS VM 的执行权限；另外还有 JS 本身的编译执行耗时，都是影响数据传输速度的因素。</p>
<h2 id="常见的-setData-操作错误"><a href="#常见的-setData-操作错误" class="headerlink" title="常见的 setData 操作错误"></a>常见的 setData 操作错误</h2><p>(1)频繁的去 setData。 Android 下用户在滑动时会感觉到卡顿，操作反馈延迟严重；渲染有出现延时。</p>
<p>(2) 每次 setData 都传递大量新数据。</p>
<p>(3)后台态页面进行 setData。</p>
<h2 id="图片资源"><a href="#图片资源" class="headerlink" title="图片资源"></a>图片资源</h2><p>图片资源的主要性能问题在于大图片和长列表图片上，这两种情况都有可能导致 iOS 客户端内存占用上升，从而触发系统回收小程序页面。除了内存问题外，大图片也会造成页面切换的卡顿。</p>
<h2 id="代码包大小的优化"><a href="#代码包大小的优化" class="headerlink" title="代码包大小的优化"></a>代码包大小的优化</h2><p>小程序一开始时代码包限制为 1MB，后增加到 2MB 。代码包上限的增加对于开发者来说，能够实现更丰富的功能，但对于用户来说，也增加了下载流量和本地空间的占用。</p>
<p><strong>控制代码包内图片资源：</strong> 小程序代码包经过编译后，会放在微信的 CDN 上供用户下载，CDN 开启了 GZIP 压缩，所以用户下载的是压缩后的 GZIP 包，其大小比代码包原体积会更小。 GZIP 对基于文本资源的压缩效果最好，在压缩较大文件时往往可高达 70%-80% 的压缩率，而如果对已经压缩的资源（例如大多数的图片格式）则效果甚微。</p>
<p><strong>及时清理没有使用到的代码和资源：</strong> 在日常开发的时候，我们可能引入了一些新的库文件，而过了一段时间后，由于各种原因又不再使用这个库了，我们常常会只是去掉了代码里的引用，而忘记删掉这类库文件了。目前小程序打包是会将工程下所有文件都打入代码包内，也就是说，这些没有被实际使用到的库文件和资源也会被打入到代码包里，从而影响到整体代码包的大小。</p>
<h1 id="组件-1"><a href="#组件-1" class="headerlink" title="组件"></a>组件</h1><p>框架为开发者提供了一系列<a href="https://www.w3cschool.cn/weixinapp/itz51q8o.html" target="_blank" rel="noopener">基础组件</a>，开发者可以通过组合这些基础组件进行快速开发。</p>
<pre><code>组件是视图层的基本组成单元。
组件自带一些功能与微信风格的样式。
一个组件通常包括开始标签和结束标签，属性用来修饰这个组件，内容在两个标签之内。
</code></pre><p>注意：所有组件与属性都是小写，以连字符-连接。</p>
<p>基础组件分为以下八大类：</p>
<p><strong>视图容器</strong>： <code>view</code>(视图容器)、 <code>scroll-view</code>（可滚动视图容器）、 <code>swiper</code>(可滑动视图容器)</p>
<p><strong>基础内容</strong>： <code>icon</code>(图标)、  <code>text</code>(文字)、  <code>progress</code>(进度条)</p>
<p><strong>表单</strong>：</p>
<pre><code>button     按钮
form     表单
input     输入框
checkbox     多项选择器
radio     单项选择器
picker     列表选择器
picker-view     内嵌列表选择器
slider     滑动选择器
switch     开关选择器
label   标签
</code></pre><p><strong>导航</strong>： <code>navigator</code>(应用内跳转)</p>
<p><strong>多媒体</strong>： </p>
<pre><code>audio     音频
image     图片
video     视频
</code></pre><p><strong>地图</strong>： <code>map</code>(地图)</p>
<p><strong>画布</strong>： <code>canvas</code>(画布)</p>
<p><strong>客服会话</strong>： <code>contact-button</code>(进入客服会话按钮)</p>
<h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><p>框架提供丰富的微信原生API，可以方便的调起微信提供的能力，如获取用户信息，本地存储，支付功能等。</p>
<pre><code>wx.on开头的API是监听某个事件发生的API接口，接受一个CALLBACK函数作为参数。当该事件触发时，会调用CALLBACK函数。
如未特殊约定，其他API接口都接受一个OBJECT作为参数。
OBJECT中可以指定success,fail,complete来接收接口调用结果。
</code></pre><h3 id="网络API"><a href="#网络API" class="headerlink" title="网络API"></a>网络API</h3><pre><code>wx.request      发起网络请求
wx.uploadFile      上传文件
wx.downloadFile      下载文件
wx.connectSocket    创建WebSocket连接
wx.onSocketOpen      监听WebSocket打开
wx.onSocketError    监听WebSocket错误
wx.sendSocketMessage    发送WebSocket消息
wx.onSocketMessage      接受WebSocket消息
wx.closeSocket      关闭WebSocket连接
wx.onSocketClose    监听WebSocket关闭
</code></pre><h3 id="媒体API"><a href="#媒体API" class="headerlink" title="媒体API"></a>媒体API</h3><pre><code>wx.chooseImage    从相册选择图片，或者拍照
wx.previewImage    预览图片
wx.startRecord    开始录音
wx.stopRecord    结束录音
wx.playVoice    播放语音
wx.pauseVoice    暂停播放语音
wx.stopVoice    结束播放语音
wx.getBackgroundAudioPlayerState    获取音乐播放状态
wx.playBackgroundAudio    播放音乐
wx.pauseBackgroundAudio    暂停播放音乐
wx.seekBackgroundAudio    控制音乐播放进度
wx.stopBackgroundAudio    停止播放音乐
wx.onBackgroundAudioPlay    监听音乐开始播放
wx.onBackgroundAudioPause    监听音乐暂停
wx.onBackgroundAudioStop    监听音乐结束
wx.chooseVideo    从相册选择视频，或者拍摄
</code></pre><h3 id="文件API"><a href="#文件API" class="headerlink" title="文件API"></a>文件API</h3><pre><code>wx.saveFile    保存文件
wx.getSavedFileList    获取已保存的文件列表
wx.getSavedFileInfo    获取已保存的文件信息
wx.removeSavedFile    删除已保存的文件信息
wx.openDocument    打开文件
</code></pre><h3 id="数据API"><a href="#数据API" class="headerlink" title="数据API"></a>数据API</h3><pre><code>wx.getStorage    获取本地数据缓存
wx.getStorageSync    获取本地数据缓存
wx.setStorage    设置本地数据缓存
wx.setStorageSync    设置本地数据缓存
wx.getStorageInfo    获取本地缓存的相关信息
wx.getStorageInfoSync    获取本地缓存的相关信息
wx.removeStorage    删除本地缓存内容
wx.removeStorageSync    删除本地缓存内容
wx.clearStorage    清理本地数据缓存
wx.clearStorageSync    清理本地数据缓存
</code></pre><h3 id="位置API"><a href="#位置API" class="headerlink" title="位置API"></a>位置API</h3><pre><code>wx.getLocation    获取当前位置
wx.chooseLocation    打开地图选择位置
wx.openLocation    打开内置地图
wx.createMapContext    地图组件控制
</code></pre><h3 id="设备API"><a href="#设备API" class="headerlink" title="设备API"></a>设备API</h3><pre><code>wx.getNetworkType    获取网络类型
wx.onNetworkStatusChange    监听网络状态变化
wx.getSystemInfo    获取系统信息
wx.getSystemInfoSync    获取系统信息
wx.onAccelerometerChange    监听加速度数据
wx.startAccelerometer    开始监听加速度数据
wx.stopAccelerometer    停止监听加速度数据
wx.onCompassChange    监听罗盘数据
wx.startCompass    开始监听罗盘数据
wx.stopCompass    停止监听罗盘数据
wx.setClipboardData    设置剪贴板内容
wx.getClipboardData    获取剪贴板内容
wx.makePhoneCall    拨打电话
wx.scanCode    扫码
</code></pre><h3 id="界面API"><a href="#界面API" class="headerlink" title="界面API"></a>界面API</h3><pre><code>wx.showToast    显示提示框
wx.showLoading    显示加载提示框
wx.hideToast    隐藏提示框
wx.hideLoading    隐藏加载提示框
wx.showModal    显示模态弹窗
wx.showActionSheet    显示菜单列表
wx.setNavigationBarTitle    设置当前页面标题
wx.showNavigationBarLoading    显示导航条加载动画
wx.hideNavigationBarLoading    隐藏导航条加载动画
wx.navigateTo    新窗口打开页面
wx.redirectTo    原窗口打开页面
wx.switchTab    切换到 tabbar 页面
wx.navigateBack    退回上一个页面
wx.createAnimation    动画
wx.createCanvasContext    创建绘图上下文
wx.drawCanvas    绘图
wx.stopPullDownRefresh    停止下拉刷新动画
</code></pre><h3 id="WXML节点信息API"><a href="#WXML节点信息API" class="headerlink" title="WXML节点信息API"></a>WXML节点信息API</h3><pre><code>wx.createSelectorQuery    创建查询请求
selectorQuery.select    根据选择器选择单个节点
selectorQuery.selectAll    根据选择器选择全部节点
selectorQuery.selectViewport    选择显示区域
nodesRef.boundingClientRect    获取布局位置和尺寸
nodesRef.scrollOffset    获取滚动位置
nodesRef.fields    获取任意字段
selectorQuery.exec    执行查询请求
</code></pre><h3 id="开放接口"><a href="#开放接口" class="headerlink" title="开放接口"></a>开放接口</h3><pre><code>wx.login    登录
wx.getUserInfo    获取用户信息
wx.chooseAddress    获取用户收货地址
wx.requestPayment    发起微信支付
wx.addCard    添加卡券
wx.openCard    打开卡券
</code></pre>
      
    </div>
    
    
    

    
    <div>
       <div>  <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-smile-o"></i>感谢您的阅读-------------</div>  </div>

    </div>
    
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" style="width: 80px;line-height: 38px;text-align: center;font-weight: bold;color: #fff;border-radius: 5px;
margin:0 20px 20px 0;position: relative;overflow: hidden;color: #8c96a0;text-shadow:1px 1px 1px #fff;border:1px solid #dce1e6;box-shadow: 0 1px 2px #fff inset,0 -1px 0 #a8abae inset;background: -webkit-linear-gradient(top,#f2f3f7,#e4e8ec);background: -moz-linear-gradient(top,#f2f3f7,#e4e8ec);background: linear-gradient(top,#f2f3f7,#e4e8ec);" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    打赏
  </button>
  <div id="QR" style="display: none; text-align: center;">

    
      <div id="wechat" style="display: inline-block;">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="ShirleyLi WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block;">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="ShirleyLi Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/wechat-smallProgram/" rel="tag"><i class="fa fa-tag"></i> wechat_smallProgram</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/24/2018-Tencent-spring-programming-simulation/" rel="next" title="2018春招研发岗在线模拟笔试编程题总结">
                <i class="fa fa-chevron-left"></i> 2018春招研发岗在线模拟笔试编程题总结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMjUzMy85MDk0"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="ShirleyLi" />
          <p class="site-author-name" itemprop="name">ShirleyLi</p>
           
              <p class="site-description motion-element" itemprop="description">Yesterday I saw a lion kiss a deer</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

      

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/shirley5li" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://stackoverflow.com/users/8237409/shirley5li" target="_blank" title="StackOverflow">
                  
                    <i class="fa fa-fw fa-stack-overflow"></i>
                  
                    
                      StackOverflow
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/shirley5li" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                    
                      Twitter
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2940695757/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      微博
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/98598367/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-douban"></i>
                  
                    
                      豆瓣
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/shirley-39-53-43/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-zhihu"></i>
                  
                    
                      知乎
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#基本的文件结构"><span class="nav-number">1.</span> <span class="nav-text">基本的文件结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建页面"><span class="nav-number">2.</span> <span class="nav-text">创建页面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#框架"><span class="nav-number">3.</span> <span class="nav-text">框架</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#配置"><span class="nav-number">4.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#逻辑层-APP-Service"><span class="nav-number">5.</span> <span class="nav-text">逻辑层(APP Service)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#注册程序"><span class="nav-number">5.1.</span> <span class="nav-text">注册程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#场景值"><span class="nav-number">5.2.</span> <span class="nav-text">场景值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注册页面"><span class="nav-number">5.3.</span> <span class="nav-text">注册页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由"><span class="nav-number">5.4.</span> <span class="nav-text">路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模块化"><span class="nav-number">5.5.</span> <span class="nav-text">模块化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#视图层-View"><span class="nav-number">6.</span> <span class="nav-text">视图层(View)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WXML"><span class="nav-number">6.1.</span> <span class="nav-text">WXML</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据绑定"><span class="nav-number">6.1.1.</span> <span class="nav-text">数据绑定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#列表渲染"><span class="nav-number">6.1.2.</span> <span class="nav-text">列表渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件渲染"><span class="nav-number">6.1.3.</span> <span class="nav-text">条件渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板"><span class="nav-number">6.1.4.</span> <span class="nav-text">模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件"><span class="nav-number">6.1.5.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#引用"><span class="nav-number">6.1.6.</span> <span class="nav-text">引用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WXS"><span class="nav-number">6.2.</span> <span class="nav-text">WXS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WXS模块"><span class="nav-number">6.2.1.</span> <span class="nav-text">WXS模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#变量"><span class="nav-number">6.2.2.</span> <span class="nav-text">变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注释"><span class="nav-number">6.2.3.</span> <span class="nav-text">注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据类型"><span class="nav-number">6.2.4.</span> <span class="nav-text">数据类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WXSS"><span class="nav-number">6.3.</span> <span class="nav-text">WXSS</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#兼容"><span class="nav-number">7.</span> <span class="nav-text">兼容</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#接口"><span class="nav-number">7.1.</span> <span class="nav-text">接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数"><span class="nav-number">7.2.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组件"><span class="nav-number">7.3.</span> <span class="nav-text">组件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#运行机制"><span class="nav-number">8.</span> <span class="nav-text">运行机制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#性能优化"><span class="nav-number">9.</span> <span class="nav-text">性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#常见的-setData-操作错误"><span class="nav-number">9.1.</span> <span class="nav-text">常见的 setData 操作错误</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图片资源"><span class="nav-number">9.2.</span> <span class="nav-text">图片资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码包大小的优化"><span class="nav-number">9.3.</span> <span class="nav-text">代码包大小的优化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#组件-1"><span class="nav-number">10.</span> <span class="nav-text">组件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#API"><span class="nav-number">11.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#网络API"><span class="nav-number">11.0.1.</span> <span class="nav-text">网络API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#媒体API"><span class="nav-number">11.0.2.</span> <span class="nav-text">媒体API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件API"><span class="nav-number">11.0.3.</span> <span class="nav-text">文件API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据API"><span class="nav-number">11.0.4.</span> <span class="nav-text">数据API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#位置API"><span class="nav-number">11.0.5.</span> <span class="nav-text">位置API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设备API"><span class="nav-number">11.0.6.</span> <span class="nav-text">设备API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#界面API"><span class="nav-number">11.0.7.</span> <span class="nav-text">界面API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WXML节点信息API"><span class="nav-number">11.0.8.</span> <span class="nav-text">WXML节点信息API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开放接口"><span class="nav-number">11.0.9.</span> <span class="nav-text">开放接口</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ShirleyLi</span>
</div>


<!--<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
-->


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> Visitors
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> Views
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  <!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>
